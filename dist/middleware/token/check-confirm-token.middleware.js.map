{"version":3,"file":"check-confirm-token.middleware.js","sourceRoot":"","sources":["../../../src/middleware/token/check-confirm-token.middleware.ts"],"names":[],"mappings":";;;AACA,+CAAwF;AACxF,yCAAwD;AACxD,8CAAgD;AAEhD,2CAA+C;AAElC,QAAA,2BAA2B,GAAG,KAAK,EAAE,GAA6B,EAAE,GAAa,EAAE,IAAkB,EAAiB,EAAE;IACnI,MAAM,KAAK,GAAG,GAAG,CAAC,GAAG,CAAC,8BAAkB,CAAC,aAAa,CAAC,CAAC;IAExD,IAAI,CAAC,KAAK,EAAE;QACV,OAAO,IAAI,CAAC,IAAI,qBAAY,CAAC,mCAAuB,CAAC,WAAW,EAAE,qBAAY,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC,CAAC;KAC/G;IAED,MAAM,CAAC,GAAG,MAAM,0BAAgB,CAAC,sBAAU,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;IAClE,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IAEf,MAAM,WAAW,GAAG,MAAM,kBAAW,CAAC,qBAAqB,CAAC,sBAAU,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;IAE7F,IAAI,CAAC,WAAW,EAAE;QAChB,OAAO,IAAI,CAAC,IAAI,qBAAY,CAAC,mCAAuB,CAAC,WAAW,EAAE,qBAAY,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;KACpG;IAED,GAAG,CAAC,IAAI,GAAG,WAAW,CAAC;IAEvB,IAAI,EAAE,CAAC;AACT,CAAC,CAAC","sourcesContent":["import {NextFunction, Response} from 'express';\r\nimport {ActionEnum, RequestHeadersEnum, ResponseStatusCodesEnum} from '../../constants';\r\nimport {customErrors, ErrorHandler} from '../../errors';\r\nimport {userService} from '../../services/user';\r\nimport {RequestExtendedInterface} from '../../models';\r\nimport {tokenVerificator} from '../../helpers';\r\n\r\nexport const checkConfirmTokenMiddleware = async (req: RequestExtendedInterface, res: Response, next: NextFunction): Promise<void> => {\r\n  const token = req.get(RequestHeadersEnum.AUTHORIZATION);\r\n\r\n  if (!token) {\r\n    return next(new ErrorHandler(ResponseStatusCodesEnum.BAD_REQUEST, customErrors.BAD_REQUEST_NO_TOKEN.message));\r\n  }\r\n\r\n  const b = await tokenVerificator(ActionEnum.USER_REGISTER, token);\r\n  console.log(b);\r\n\r\n  const userByToken = await userService.findUserByActionToken(ActionEnum.USER_REGISTER, token);\r\n\r\n  if (!userByToken) {\r\n    return next(new ErrorHandler(ResponseStatusCodesEnum.BAD_REQUEST, customErrors.NOT_FOUND.message));\r\n  }\r\n\r\n  req.user = userByToken;\r\n\r\n  next();\r\n};\r\n"]}